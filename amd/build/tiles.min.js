define(["jquery"],function(a){var b,c,d,e=a(".block_course_overview_ext .course_list"),f=function(a){for(var d=a.children("a").outerWidth(),e=0;e<b.length&&b[e]<d;)++e;a.width(c[e]+"%")},g=function(){var a=d;return d=e.width()<700?1:e.width()<970?2:3,d!=a},h=function(a,b){return b.replace(/\W*\s(\S)*$/,"...")},i=function(b,c){for(var d=a(c).children("a");d.outerHeight()>34;)d.text(h)},j=function(){var b=a(".block_course_overview_ext.view.tiles .coursebox .course_title .title");b.each(i)},k=function(){if(e){var h=e.children(".coursebox"),i=20,k=35;if(h&&g()){var l=e.width()/d-i;b=[l-k];var m;for(m=1;d>m;++m)b[b.length]=b[m-1]+l+i;for(c=[b[0]/e.width()*100],m=1;m<b.length;++m)c[m]=b[m]/e.width()*100;h.each(function(){f(a(this))})}j()}},l=function(b){var c=a("#"+b.data.id+" .co_popup").hasClass("visible");return a(".co_popup").removeClass("visible"),c===!1&&a("#"+b.data.id+" .co_popup").toggleClass("visible"),!1},m=function(){a(".co_popup").removeClass("visible")},n=function(b){var c=a(b.target).css("backgroundColor"),d=b.data.id,e=d.slice(d.indexOf("_")+1,d.lastIndexOf("_"));return a("#course-"+e).closest(".coursebox").css("backgroundColor",c),b.data.save===!0?r():a(".co_saveColor .singlebutton").removeClass("btn-disabled"),!1},o=function(b){a(b).css("display","block"),a(b).fadeOut("slow")},p=function(a){return-1==a.search("rgb")?a:(a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+q(a[1])+q(a[2])+q(a[3]))},q=function(a){return("0"+parseInt(a).toString(16)).slice(-2)},r=function(){var b=[],c=[];a(".course_list").children().each(function(d,e){b[b.length]=a(e).attr("id").substring(7),c[c.length]=p(a(e).css("backgroundColor")).toUpperCase()});var d={sesskey:M.cfg.sesskey,courselist:b,colorlist:c},e=function(){};return a.ajax(M.cfg.wwwroot+"/blocks/course_overview_ext/color_save.php",{method:"POST",data:a.param(d),context:M.block_course_overview_ext,success:function(){},error:function(){},complete:function(){e()}}),!1},s=function(b){var c=a(b.data.button).hasClass("btn-disabled");if(!c){var d=[],e=[];a(".course_list").children().each(function(b,c){d[d.length]=a(c).attr("id").substring(7),e[e.length]=p(a(c).css("backgroundColor")).toUpperCase()});var f={sesskey:M.cfg.sesskey,courselist:d,colorlist:e},g=function(){};a(".co-notification")&&(g=function(){o(b.data.notification),a(b.data.button).addClass("btn-disabled")}),a.ajax(M.cfg.wwwroot+"/blocks/course_overview_ext/color_save.php",{method:"POST",data:a.param(f),context:M.block_course_overview_ext,success:function(){},error:function(){},complete:function(){g()}})}return!1};return{init:function(){k(),a(window).resize(k)},pop:function(b){a("#"+b).click({id:b},l)},closeAllPopups:function(){a(window).click(m)},isColor:function(b,c){a("#"+b).on("click",".color",{id:b,save:c},n)},saveColorButton:function(b,c){a(b).click({button:b,notification:c},s)},setColor:function(b,c){for(var d=0;d<b.length;d++)a("#course-"+b[d]).css("backgroundColor",c[d])}}});