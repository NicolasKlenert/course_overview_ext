define(["jquery"],function(a){var b,c,d,e=a(".block_course_overview_ext .course_list"),f=function(a){for(var d=a.children("a").outerWidth(),e=0;e<b.length&&b[e]<d;)++e;a.width(c[e]+"%")},g=function(){var a=d;return d=e.width()<700?1:e.width()<970?2:3,d!=a},h=function(){if(e){var h=e.children(".coursebox"),i=20,j=35;if(h&&g()){var k=e.width()/d-i;b=[k-j];var l;for(l=1;d>l;++l)b[b.length]=b[l-1]+k+i;for(c=[b[0]/e.width()*100],l=1;l<b.length;++l)c[l]=b[l]/e.width()*100;h.each(function(){f(a(this))})}}},i=function(b){return a(".co_popup").removeClass("visible"),a("#"+b.data.id+" .co_popup").toggleClass("visible"),!1},j=function(){a(".co_popup").removeClass("visible")},k=function(b){var c=a(b.target).css("backgroundColor");return a("#"+b.data.id).parents(".coursebox").css("backgroundColor",c),a(".co_saveColor .singlebutton").removeClass("btn-disabled"),!1},l=function(b){a(b).css("display","block"),a(b).fadeOut("slow")},m=function(a){return-1==a.search("rgb")?a:(a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+n(a[1])+n(a[2])+n(a[3]))},n=function(a){return("0"+parseInt(a).toString(16)).slice(-2)},o=function(b){var c=[],d=[];a(".course_list").children().each(function(b,e){c[c.length]=a(e).attr("id").substring(7),d[d.length]=m(a(e).css("backgroundColor")).toUpperCase()});var e={sesskey:M.cfg.sesskey,courselist:c,colorlist:d},f=function(){};return a(".co-notification")&&(f=function(){l(b.data.notification),a(b.data.button).addClass("btn-disabled")}),a.ajax(M.cfg.wwwroot+"/blocks/course_overview_ext/color_save.php",{method:"POST",data:a.param(e),context:M.block_course_overview_ext,success:function(){},error:function(){},complete:function(){f()}}),!1};return{init:function(){h(),a(window).resize(h)},pop:function(b){a("#"+b).click({id:b},i)},closeAllPopups:function(){a(window).click(j)},isColor:function(b){a("#"+b).on("click",".color",{id:b},k)},saveColor:function(b,c){a(b).click({button:b,notification:c},o)},setColor:function(b,c){for(var d=0;d<b.length;d++)a("#course-"+b[d]).css("backgroundColor",c[d])}}});